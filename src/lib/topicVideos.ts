// Mapping of topic titles to YouTube video URLs
// Using normalized keys for better matching
export const topicVideos: Record<string, string> = {
  // Dars 1 - Chorraxalar
  "tartibga soluvchini ishoralari": "https://youtu.be/ioCCi64FrD8",
  "tartibga solingan chorraxalar": "https://youtu.be/NkchbbemTXc",
  "tartibga solinmagan chorraxalar asosiy yo'l to'g'riga": "https://youtu.be/E4jGGu6PMJQ",
  "tartibga solinmagan chorraxalar asosiy yol togriga": "https://youtu.be/E4jGGu6PMJQ",
  "tartibga solinmagan chorraxalar asosiy yo'l yo'nalishi o'zgarishi": "https://youtu.be/xXTW7ZARxOg",
  "tartibga solinmagan chorraxalar asosiy yol yonalishi ozgarishi": "https://youtu.be/xXTW7ZARxOg",
  "teng axamiyatli chorraxalar": "https://youtu.be/11_mlzzJikU",
  "teng ahamiyatli chorraxalar": "https://youtu.be/11_mlzzJikU",
  "чорраҳаларда ҳаракатланиш": "https://youtu.be/zvcFZ90IThY",
  "chorrahalarda harakatlanish": "https://youtu.be/zvcFZ90IThY",
  
  // Dars 2 - Belgilar
  "ogohlantiruvchi belgilar full": "https://youtu.be/r7NzVP_r0PM",
  "ogohlantiruvchi belgilar": "https://youtu.be/r7NzVP_r0PM",
  "imtiyoz belgilari": "https://youtu.be/iAvP2W0IaPk",
  "taqiqlovchi belgilar": "https://youtu.be/J2G6usQzeuM",
  "buyuruvchi belgilar": "https://youtu.be/s_7uidszseI",
  "axborot ko'rsatkich belgialari": "https://youtu.be/O88nJX_d1FY",
  "axborot korsatkich belgialari": "https://youtu.be/O88nJX_d1FY",
  "servis belgilari": "https://youtu.be/_DfuGD28CbY",
  "qo'shimcha axborot belgilari": "https://youtu.be/5qKdHSE6iK8",
  "qoshimcha axborot belgilari": "https://youtu.be/5qKdHSE6iK8",
  
  // Dars 3
  "транспорт воситаларидан фойдаланишни тақиқловчи шартлар": "https://youtu.be/E3LDGhh6j2Q",
  "ҳаракат хафсизлиги асослари": "https://youtu.be/JEoGeP4ATPs",
  "harakat xafsizligi asoslari": "https://youtu.be/JEoGeP4ATPs",
  "manyovr qilish": "https://youtu.be/sBrjLMwagNA",
  "маневр қилиш": "https://youtu.be/sBrjLMwagNA",
  "биринчи тиббий ёрдам": "https://youtu.be/wd-0VDL_A9o",
  "birinchi tibbiy yordam": "https://youtu.be/wd-0VDL_A9o",
  
  // Dars 4 - Chiziqlar
  "тик чизиқлар": "https://youtu.be/Gv7SDCJIaiY",
  "tik chiziqlar": "https://youtu.be/Gv7SDCJIaiY",
  "ётиқ чизиқлар": "https://youtu.be/Df1XcWr2FWg",
  "yotiq chiziqlar": "https://youtu.be/Df1XcWr2FWg",
  "toxtash va to'xtab turish": "https://youtu.be/VRAPyVoJSUU",
  "toxtash va toxtab turish": "https://youtu.be/VRAPyVoJSUU",
  "тўхташ ва тўхтаб туриш": "https://youtu.be/VRAPyVoJSUU",
  "ҳаракатланиш тезлиги": "https://youtu.be/HR6L6ow1mRg",
  "harakatlanish tezligi": "https://youtu.be/HR6L6ow1mRg",
  
  // Dars 5
  "umumiy qoidalar": "https://youtu.be/7Ax3KHMF2So",
  "умумий қоидалар": "https://youtu.be/7Ax3KHMF2So",
  "quvib otish": "https://youtu.be/ehAOwLVT8VE",
  "қувиб ўтиш": "https://youtu.be/ehAOwLVT8VE",
  "темир йўл кесишмалари орқали ҳаракатланиш": "https://youtu.be/mgm2bVWhfI0",
  "temir yol kesishmalari orqali harakatlanish": "https://youtu.be/mgm2bVWhfI0",
  "йўлнинг қатнов қисмида транспорт воситаларининг жойлашуви": "https://youtu.be/HgmX5-m39tU",
  "yolning qatnov qismida transport vositalarining joylashuvi": "https://youtu.be/HgmX5-m39tU",
  "автомагистралларда ҳаракатланиш": "https://youtu.be/UbXYdV0mfac",
  "avtomagistralarda harakatlanish": "https://youtu.be/UbXYdV0mfac",
  "турар жой даҳаларида ҳаракатланиш": "https://youtu.be/yr3dAqq9eQI",
  "turar joy dahalarida harakatlanish": "https://youtu.be/yr3dAqq9eQI",
  
  // Dars 6
  "xaydovchilarning umumiy vazifalari": "https://youtu.be/Njpg27Wmihg",
  "ҳайдовчиларнинг умумий вазифалари": "https://youtu.be/Njpg27Wmihg",
  "пиёдаларнинг ўтиш жойлари ва йўналишли транспорт воситаларининг бекатлари": "https://youtu.be/ID_zXs3bedk",
  "piyodalarning otish joylari": "https://youtu.be/ID_zXs3bedk",
  "piyodalarning umumiy vazifalari": "https://youtu.be/9C2-AXROtdo",
  "пиёдаларнинг умумий вазифалари": "https://youtu.be/9C2-AXROtdo",
  "maxsus transport vositalarining imtiyozlari": "https://youtu.be/GlEA50j95Tg",
  "махсус транспорт воситаларининг имтиёзлари": "https://youtu.be/GlEA50j95Tg",
  "йўналишли транспорт воситаларининг имтиёзлари": "https://youtu.be/8JK8Y60mXKA",
  "yonalishli transport vositalarining imtiyozlari": "https://youtu.be/8JK8Y60mXKA",
  "ogoxlantiruvchi xavf ishoralari": "https://youtu.be/r7NzVP_r0PM",
  "огоҳлантирувчи хавф ишоралари": "https://youtu.be/r7NzVP_r0PM",
  "ташқи ёритиш асбобларидан фойдаланиш": "https://youtu.be/1UiVMKoJD5s",
  "tashqi yoritish asboblaridan foydalanish": "https://youtu.be/1UiVMKoJD5s",
  "механик транспорт воситаларини шатакка олиш": "https://youtu.be/3LS9rnDUOmM",
  "mexanik transport vositalarini shatakka olish": "https://youtu.be/3LS9rnDUOmM",
  "юк ташиш": "https://youtu.be/wOb0VWt8RAI",
  "yuk tashish": "https://youtu.be/wOb0VWt8RAI",
  "велосипед, мопед ва аравалар ҳаракатланишига": "https://youtu.be/cf4oOFMKdKs",
  "velosiped moped va aravalar": "https://youtu.be/cf4oOFMKdKs",
  "транспорт воситаларини бошқаришни ўргатиш": "https://youtu.be/JXdLQtcg4kI",
  "transport vositalarini boshqarishni orgatish": "https://youtu.be/JXdLQtcg4kI",
  "мансабдор шахсларнинг ва фуқароларнинг йўл ҳаракати хавфсизлигини таъминлаш": "https://youtu.be/nahzjWgBXVY",
  "mansabdor shaxslarning": "https://youtu.be/nahzjWgBXVY",
  "тик баландлик ва нишабликларда ҳаракатланиш": "https://youtu.be/aj_ij_JRbEo",
  "tik balandlik va nishabliklarда harakatlanish": "https://youtu.be/aj_ij_JRbEo",
};

// Normalize string for matching - remove special chars, lowercase, trim
function normalizeString(str: string): string {
  return str
    .toLowerCase()
    .trim()
    // Replace common character variations
    .replace(/'/g, "'")
    .replace(/ʻ/g, "'")
    .replace(/ʼ/g, "'")
    .replace(/`/g, "'")
    .replace(/['']/g, "'")
    // Remove extra spaces
    .replace(/\s+/g, ' ');
}

// Function to get YouTube embed URL from regular YouTube URL
export function getYouTubeEmbedUrl(url: string): string {
  let videoId = '';
  
  if (url.includes('youtu.be/')) {
    videoId = url.split('youtu.be/')[1]?.split('?')[0] || '';
  } else if (url.includes('youtube.com/watch')) {
    const urlParams = new URLSearchParams(url.split('?')[1]);
    videoId = urlParams.get('v') || '';
  } else if (url.includes('youtube.com/embed/')) {
    videoId = url.split('embed/')[1]?.split('?')[0] || '';
  }
  
  return `https://www.youtube.com/embed/${videoId}`;
}

// Function to find video URL for a topic by title
export function findVideoForTopic(topicTitle: string): string | null {
  if (!topicTitle) {
    console.log('[TopicVideos] No topic title provided');
    return null;
  }
  
  const normalizedTitle = normalizeString(topicTitle);
  console.log('[TopicVideos] Looking for video:', topicTitle, '-> normalized:', normalizedTitle);
  
  // First try exact match with normalized title
  if (topicVideos[normalizedTitle]) {
    console.log('[TopicVideos] Found exact match');
    return topicVideos[normalizedTitle];
  }
  
  // Try matching normalized keys
  for (const [key, value] of Object.entries(topicVideos)) {
    const normalizedKey = normalizeString(key);
    if (normalizedKey === normalizedTitle) {
      console.log('[TopicVideos] Found normalized match:', key);
      return value;
    }
  }
  
  // Try partial match - if title contains key or key contains title
  for (const [key, value] of Object.entries(topicVideos)) {
    const normalizedKey = normalizeString(key);
    if (normalizedTitle.includes(normalizedKey) || normalizedKey.includes(normalizedTitle)) {
      console.log('[TopicVideos] Found partial match:', key);
      return value;
    }
  }
  
  // Try word-by-word match (at least 2 significant words matching)
  const titleWords = normalizedTitle.split(' ').filter(w => w.length > 2);
  for (const [key, value] of Object.entries(topicVideos)) {
    const keyWords = normalizeString(key).split(' ').filter(w => w.length > 2);
    const matchingWords = titleWords.filter(tw => keyWords.some(kw => kw.includes(tw) || tw.includes(kw)));
    if (matchingWords.length >= 2) {
      console.log('[TopicVideos] Found word match:', key, 'matching words:', matchingWords);
      return value;
    }
  }
  
  console.log('[TopicVideos] No video found for:', topicTitle);
  return null;
}
